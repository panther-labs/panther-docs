---
description: >-
  Panther Cloud Security Scanning uses policies to detect misconfigurations in
  AWS accounts
---

# Cloud Security Scanning

## Overview

Panther's Cloud Security Scanning works by scanning AWS accounts, modeling the **Resources** within them, and using **Policies** to detect misconfigurations. Cloud Security Scanning is automatically enabled when you onboard a Cloud Account to your Panther Console.

This feature can be used to power your compliance and improve your cloud security posture. Common security misconfigurations detectable by Panther include:

* S3 Buckets without encryption
* Security Groups allowing inbound SSH traffic from `0.0.0.0/0`
* Access Keys being older than 90 days
* IAM policies that are too permissive

When adding a new AWS account, Panther runs a baseline scan and models all of the resources in your account. Account scans are performed _daily_ to ensure the most consistent state possible. This works by using an assumable IAM Role with ReadOnly permissions.

## How to use Cloud Security Scanning

Onboarding a Cloud Account in Panther will automatically enable Cloud Security Scanning. Panther will scan the resources to check for potential vulnerabilities.

Additionally, we recommend [onboarding your CloudTrail or CloudWatch logs as a log source integration](../data-onboarding/supported-logs/aws.md) so you can configure Detections and receive alerts for active incidents and breaches.

### Onboarding the Cloud Account in Panther

1. Log in to your Panther Console.
2. In the left sidebar, click **Integrations > Cloud Accounts** then click **Connect an account**.
3. Enter your account **Name** and **AWS Account ID**.&#x20;
   * You may also expand the **Advanced Options** to indicate which AWS Regions, Resource Types, and Resources by Region you would like to exclude from cloud scanning. This can help prevent too many alerts from being generated by regions and resources known to be misconfigured.\
     ![](../.gitbook/assets/cloud-account-aws.png)
4. Click **Continue Setup**.

### Set up an IAM Role

Panther needs an IAM Role to have the ability to scan resources from your AWS account. You can choose from the following options to set this up:

* [Using the AWS Console UI](./#creating-an-iam-role-using-the-aws-console-ui): Launch a CloudFormation stack using the AWS console.&#x20;
* [CloudFormation or Terraform Template File](./#creating-an-iam-role-using-a-cloudformation-or-terraform-template-file): Use Panther's provided CloudFormation template or Terraform template to create an IAM role by downloading the template and deploying on your own.
* [I want to set up everything on my own](./#creating-an-iam-role-manually-or-with-other-automation): Create the IAM role manually or with other automation.

![The Setup an IAM Role page displays options for Using the AWS Console UI, CloudFormation or Terraform template, or "I want to set up everything on my own."](<../.gitbook/assets/Screen Shot 2022-04-13 at 1.00.46 PM (1).png>)

#### Creating an IAM Role using the AWS Console UI

1. On the "Setup an IAM Role" page, click **Select** next to **Using the AWS Console UI**.
2. Click **Launch Console UI.**
   * You will be redirected to the AWS console in a new browser tab, with the template URL pre-filled.&#x20;
   * Check the acknowledgements in the "Capabilities" box, and click **Create Stack.**
3. Navigate back to your Panther Console.
4. Click **Continue Setup** to complete the Cloud Account setup process.

#### Creating an IAM Role using a CloudFormation or Terraform Template File

1. On the "Setup an IAM Role page", click **Select** next to **CloudFormation or Terraform Template File**.
2. Click the template option you want to use, which downloads the template to apply it through your own pipeline.&#x20;
3. Upload the template file in AWS.
4. Once deployed, navigate back to the Panther Console, and click **Continue Setup.**

![The "Setup an IAM Role" page displays options for CloudFormation template and Terraform template.](<../.gitbook/assets/Screen Shot 2022-04-13 at 2.52.10 PM.png>)

#### Creating an IAM role manually or with other automation

If you wish to create an IAM role via some other mechanism, ensure it has the naming standard and permissions documented in [Pantherâ€™s provided templates](./#creating-an-iam-role-using-a-cloudformation-or-terraform-template-file).

1. On the "Set Up an IAM role" page, click the link that says **I want to set everything up on my own**.
2. Create the required IAM role. You may create the required IAM role manually or through your own automation.

### Finish the Cloud Account setup process

The Setup Verification page verifies whether the IAM role has been successfully created.

1. Optionally, you can click **Setup CloudTrail** to enable Real Time Scanning.&#x20;
   * If you have already configured a Log Source containing CloudTrail Logs or if you would like to configure this later, you may skip this step.
2. Click **Finish Setup**.

![The final page in Cloud Account setup displays "Everything looks good."](../.gitbook/assets/finish-cloud-account-setup.png)

{% hint style="info" %}
_By default, Panther will perform scans daily._
{% endhint %}

## Real-time monitoring

### CloudTrail logs

To set up real-time monitoring via CloudTrail logs, follow the instructions to [onboard CloudTrail logs](../data-onboarding/supported-logs/aws.md).

### CloudWatch events

To leverage CloudWatch events for resource scanning and monitoring, you must configure a template in AWS and then onboard your Cloud Account.

Within [panther-auxiliary](https://github.com/panther-labs/panther-auxiliary/blob/main/cloudformation/panther-cloudwatch-events.yml), review the `panther-cloudwatch-events.yml` file. This YAML file contains the CloudFormation stack information necessary to configure Panther's real-time CloudWatch Event collection.

It works by creating CloudWatch Event rules which feed to Panther's SQS Queue proxied by a local SNS topic in each region. Latency between an event occurring in AWS and the event being detected by CloudWatch Event rules is typically 1 minute or less.

#### Configure CloudFormation

1. &#x20;[Download](https://github.com/panther-labs/panther-auxiliary/blob/main/cloudformation/panther-cloudwatch-events.yml) the `panther-cloudwatch-events.yml` file.
2. Launch your AWS console and navigate to the CloudFormation project.
3. Click **Create stack** and choose the option "With new resources."&#x20;
4. In the **Template** section, choose the option _Upload a template file_. Select your `panther-cloudwatch-events.yml` file.
5. Click **Next**.
6. In the **Specify Details** section, fill in the necessary fields, including the following:
   * **Stack name**: `panther-real-time-events`
   * **QueueArn**: `arn:aws:sqs:<PantherRegion>:<PantherAccountID>:panther-aws-events-queue`
7. Click **Next**.
8. On the **Configure stack options** page, click **Next**.
9. On the **Review** page, make sure you have configured your settings correctly. Click **Next**.

After configuring the template, follow the instructions to [onboard your cloud account](./#configure-the-cloud-account-in-panther).

## Cloud Resource Attributes

To learn more about the attributes that can be referenced in Cloud Security policies, see [Cloud Resource Attributes](./#cloud-resource-attributes).
